# 上行短信安全性分析-可能的逻辑漏洞 #

## a. 接口没设频次上限导致短信轰炸 ##

**起因**：服务器通过使用POST请求向用户发送短信验证码。攻击者使用抓包软件可以重放请求。对于后端没有做限制的网站就可以达到短信轰炸的效果。

**危害**：对用户来说个人生活受到骚扰，企业也会受到一定的负面影响。

**预防**：这里主要是针对两种攻击场景来进行防御，第一种是对单用户的短信轰炸，即重放发送请求且phonenum为一个值。第二种是对多用户发送短信骚扰的场景，即将phonenum参数设置为字典，重放短信接口。

设置发送间隔，即单一用户发送请求后，与下次发送请求时间需要间隔60秒。

设置单用户发送上限，即设置每个用户单位时间内发送短信数的上限，如果超过阈值就不允许今天再次调用短信接口（阈值根据业务情况设置）。

设置单IP发送上限，这种情况是预防第二种攻击场景的，由于IP的特殊性可能存在所处IP是大出口，一旦误杀后果会很验证，所以这个限制根据自身情况酌情考虑，对于有风控的团队来说，当发现发送IP存在异常可以对该IP增加二次认证来防止机器操作，也可以降低误杀情况。


## b. 验证码内容包含在返回包中 ##

**起因**：因为开发不严谨导致通过抓包可以看到验证码在回显中显示。

![](https://github.com/yakkwang/ns/blob/%E5%A4%A7%E4%BD%9C%E4%B8%9A/2017-2/%E5%A4%A7%E4%BD%9C%E4%B8%9A/%E4%B8%8B%E8%A1%8C%E7%9F%AD%E4%BF%A1%E5%AE%89%E5%85%A8%E6%80%A7%E5%88%86%E6%9E%90-%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/b.png)

**危害**：由于验证码直接返回，通过该漏洞可以注册任意用户，重置已注册用户密码，修改绑定信息等高危操作，对用户造成一定影响。

**修复建议**：不要将短信验证码在回显中显示，验证码只存于服务端中并不能通过任何api直接获取。


## c. 修改返回包内容绕过验证 ##

**起因**：前端校验导致下列问题。

![](https://github.com/yakkwang/ns/blob/%E5%A4%A7%E4%BD%9C%E4%B8%9A/2017-2/%E5%A4%A7%E4%BD%9C%E4%B8%9A/%E4%B8%8B%E8%A1%8C%E7%9F%AD%E4%BF%A1%E5%AE%89%E5%85%A8%E6%80%A7%E5%88%86%E6%9E%90-%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E/c.png)

**危害**：可跳过正常校验逻辑。

**修复建议**：服务端严格做检验。


### 参考链接 ### [验证码安全那些事](http://www.freebuf.com/articles/rookie/131542.html)
